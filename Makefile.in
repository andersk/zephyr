SHELL = /bin/sh

prefix=@prefix@
exec_prefix=@exec_prefix@
datadir=@datadir@
sysconfdir=@sysconfdir@
sbindir=@sbindir@
datarootdir=@datarootdir@

includedir=@includedir@
mandir=@mandir@
bindir=@bindir@
libdir=@libdir@

srcdir=@srcdir@
top_srcdir=@top_srcdir@
INSTALL=@INSTALL@

SUBDIRS=lib clients server zhm zwgc

build:
	$(MAKE) all

h/zephyr_version.h: always
	sh -x ${srcdir}/new_vers.sh $(top_srcdir)

clean: clean_version

clean_version:
	$(RM) h/zephyr_version.h

all: h/zephyr_version.h

all check clean:
	for i in ${SUBDIRS}; do (cd $$i; ${MAKE} $@) || exit 1; done

install:
	${INSTALL} -d ${DESTDIR}${prefix} 755
	${INSTALL} -d ${DESTDIR}${exec_prefix} 755
	${INSTALL} -d ${DESTDIR}${bindir} 755
	${INSTALL} -d ${DESTDIR}${libdir} 755
	${INSTALL} -d ${DESTDIR}${datadir} 755
	${INSTALL} -d ${DESTDIR}${datadir}/zephyr 755
	${INSTALL} -d ${DESTDIR}${sysconfdir} 755
	${INSTALL} -d ${DESTDIR}${sysconfdir}/zephyr/acl 755
	${INSTALL} -d ${DESTDIR}${sbindir} 755
	${INSTALL} -d ${DESTDIR}${includedir} 755
	${INSTALL} -d ${DESTDIR}${includedir}/zephyr 755
	${INSTALL} -d ${DESTDIR}${mandir} 755
	${INSTALL} -d ${DESTDIR}${mandir}/man1 755
	${INSTALL} -d ${DESTDIR}${mandir}/man3 755
	${INSTALL} -d ${DESTDIR}${mandir}/man8 755
	${INSTALL} -m 644 ${srcdir}/h/zephyr/mit-copyright.h \
		${DESTDIR}${includedir}/zephyr
	${INSTALL} -m 644 ${srcdir}/h/zephyr/zephyr.h \
		${DESTDIR}${includedir}/zephyr
	${INSTALL} -m 644 h/zephyr/zephyr_err.h ${DESTDIR}${includedir}/zephyr
	for i in ${SUBDIRS}; do (cd $$i; ${MAKE} $@) || exit 1; done

always:

.PHONY: all build check install clean clean_version always

